{% extends "post_login_accounts.html" %}
{% block content %}

<form id="new-intent" action="/new_multi_receipt/{{ user._id }}" method="post">

<div style="display: flex; flex-direction: column; align-items: center; flex: 1; justify-content: space-around; margin-top: 10px">

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 8" for="natureOfTransaction">Transaction Type</label>
        <select style="flex: 4" class="form-control" id="natureOfTransaction" name="natureOfTransaction">
            {% set nature = ['Debit', 'Credit', 'Multi-Ledger'] %}

            {% for nat in nature %}
                <option value= "{{nat}}">{{nat}}</option>"
            {% endfor %}
        </select>
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 8" for="mode">Mode</label>
        <select style="flex: 4" class="form-control" id="mode" name="mode">
            {% set nature = ['Journal Voucher', 'Bank Payment'] %}

            {% for nat in nature %}
                <option value= "{{nat}}">{{nat}}</option>"
            {% endfor %}
        </select>
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 8" for="ledger">Ledger</label>
        <select style="flex: 4" class="form-control" id="ledger" name="ledger">
            {% set nature = ['Sub', 'Main'] %}

            {% for nat in nature %}
                <option value= "{{nat}}">{{nat}}</option>"
            {% endfor %}
        </select>
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 8" for="adjustmentVoucher">Adjustment Voucher</label>
        <select style="flex: 4" class="form-control" id="adjustmentVoucher" name="adjustmentVoucher">
            {% set nature = ['No', 'Yes'] %}

            {% for nat in nature %}
                <option value= "{{nat}}">{{nat}}</option>"
            {% endfor %}
        </select>
    </div>

    <div style="display: flex; flex-direction: row; justify-content: space-around;">
        <button type="button"><a onclick="addAnotherField()">Add Another Field</a></button>
        <button type="button"><a onclick="populateTotals()">Done</a></button>
    </div>

    <div id="shgDetails" class="form-group">
    </div>

    <div class="form-group" style="display: flex; flex-direction: row; justify-content: space-between;">
        <div>
            <label style="flex: 4" for="totalDebit">Total Debit</label>
            <input type="number" id="totalDebit" name="totalDebit" style="display: block; width: 100%">
        </div>
        <div>
            <label style="flex: 4" for="totalCredit">Total Credit</label>
            <input type="number" id="totalCredit" name="totalCredit" style="display: block; width: 100%">
        </div>
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 4" for="bankAccount">TABCEDCO Account</label>
        <input type="text" id="bankAccount" name="bankAccount" style="display: block; width: 100%">
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 4" for="depositingBank">External Bank Account</label>
        <input type="text" id="depositingBank" name="depositingBank" style="display: block; width: 100%">
    </div>

    <div class="form-group" style="display: flex; flex-direction: row; justify-content: space-between;">
        <div style="margin-left: 10px">
            <label for="invoiceDate">Invoice Date</label>
            <input type="date" value="" id="invoiceDate" name="invoiceDate">
        </div>
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 4" for="cheque">Cheque/RTGS/DD #</label>
        <input type="text" id="cheque" name="cheque" style="display: block; width: 100%">
    </div>

    <div class="form-group" style="display: block; width: 38%">
        <label style="flex: 4" for="narration">Narration for Bill</label>
        <input type="text" id="narration" name="narration" style="display: block; width: 100%">
    </div>

    <div class="form-group" style="display: flex; flex-direction: row; justify-content: space-between;">
        <label style="flex: 4" for="paymentVoucher">Voucher Number</label>
        <input type="text" id="paymentVoucher" name="paymentVoucher" style="display: block; width: 100%">
        <div style="margin-left: 10px">
            <label for="voucherDate">Voucher Date</label>
            <input type="date" value="" id="voucherDate" name="voucherDate">
        </div>
        <div style="margin-left: 10px">
            <label for="chequeDate">Cheque Date</label>
            <input type="date" value="" id="chequeDate" name="chequeDate">
        </div>
    </div>

    <input style="display: none" type="text" value="" id="invID" name="invID">

    <button type="submit" class="btn btn-success">Save Bill Details</button>

</div>
</form>

<script>

    var i = 0;
    var shg_det = $("#shgDetails");
    shg_det.empty();
    var inputSNO = "sno"+i;
    var accHead = "acchead"+i;
    var debit_amount = "debit_amount"+i;
    var credit_amount = "credit_amount"+i;
    var debit_bal = "new_debit_bal"+i;
    var credit_bal = "new_credit_bal"+i;
    document.getElementById('natureOfTransaction').value = 'Multi-Ledger';
    var row = $('<div style="display: flex; flex-direction: row; justify-content: space-around; align-items: center;"></div>')
        .html(
            '<div style="display: flex; flex-direction: column;">' +
            '<label for='+inputSNO+'>S.No</label>' +
            '<input class="amount" type="number" id='+inputSNO+' name='+inputSNO+' value='+(i+1)+'>' +
            '</div>' +
            '<div style="display: flex; flex: 3; flex-direction: column;">' +
            '<label for='+accHead+'>Account Head</label>' +
            '<select class="select" id='+accHead+' name='+accHead+'>' +
            '</select>'+
            '</div>' +
            '<div style="display: flex; flex: 5; flex-direction: column;">' +
            '<label for='+debit_amount+'>Cl. Debit</label>' +
            '<input type="text" id='+debit_amount+' name='+debit_amount+'>' +
            '</div>' +
            '<div style="display: flex; flex: 3; flex-direction: column;">' +
            '<label for='+credit_amount+'>Cl. Credit</label>' +
            '<input type="text" id='+credit_amount+' onchange="populateNewBalances('+credit_amount+','+debit_amount+','+accHead+')" name='+credit_amount+'>' +
            '</div>' +
            '<div style="display: None; flex: 3; flex-direction: column;">' +
            '<label for='+credit_bal+'>Cl. Credit</label>' +
            '<input type="text" id='+credit_bal+' name='+credit_bal+'>' +
            '</div>' +
            '<div style="display: None; flex: 3; flex-direction: column;">' +
            '<label for='+debit_bal+'>Cl. Credit</label>' +
            '<input type="text" id='+debit_bal+' name='+debit_bal+'>' +
            '</div>'
        );
        shg_det.append(row);
        i++;
        populateSelect();

    function populateNewBalances(credit_id, debit_id, hoa) {
        var hoaccount = document.getElementById(hoa.id).value;
        var source = "/raw_acc_head_opening_balance/"+hoaccount;
        $.ajax({
            type: 'GET',
            url: source,
            contentType: "application/json",
            dataType: 'json',
            success: function (json) {
                var credit_value = parseInt(document.getElementById(credit_id.id).value);
                var debit_value = parseInt(document.getElementById(debit_id.id).value);
                var old_debit_balance = json[0]["Cl"]["Debit Bal"];
                var old_credit_balance = json[0]["Cl"]["Credit Bal"];

                if (credit_value > 0 && old_credit_balance > 0) {
                    var new_credit_balance = credit_value + old_credit_balance;
                    var new_debit_balance = 0;
                }
                if (debit_value > 0 && old_debit_balance > 0) {
                    new_credit_balance = 0;
                    new_debit_balance = debit_value + old_debit_balance;
                }
                if (credit_value > 0 && old_debit_balance > 0) {
                    if (old_debit_balance >= credit_value) {
                        new_debit_balance = old_debit_balance - credit_value;
                        new_credit_balance = 0;
                    } else {
                        new_debit_balance = 0;
                        new_credit_balance = credit_value - old_debit_balance;
                    }
                }
                if (debit_value > 0 && old_credit_balance > 0) {
                    if (old_credit_balance >= debit_value) {
                        new_credit_balance = old_credit_balance - debit_value;
                        new_debit_balance = 0;
                    } else {
                        new_credit_balance = 0;
                        new_debit_balance = debit_value - old_credit_balance;
                    }
                }
                console.log(new_credit_balance, new_debit_balance);
            },
            error: function (e) {
                alert("error");
            }
        });
    }

    function populateSelect() {
        var selectValues = ['ADVANCE TO TUCS LTD.', 'ADVANCE-NEW CATHEDRAL SERVICE STATION', 'ADVANCES', 'AMOUNT DUE FROM CTA', 'AMOUNT PAYABLE TO TAMCO (CAR)', 'AMOUNT RECEIVABLE FROM ELCOT', 'AMOUNT RECEIVABLE FROM NBCFDC', 'AMOUNT RECEIVED FROM GOVT (IRRI)', 'AMOUNT TRANSFERRED TO TAMCO', 'AMT REC FROM NBCFDC FOR EXHIBITION', 'AMT REVD FROM GOVT - JOT (PD A/c)', 'ARREARS PAYABLE', 'BAD AND DOUBTFUL DEBTS', 'BANK CHARGES', 'BANK OF BARODA , MOUNT ROAD BR', 'MOUNT ROAD BR', 'BOARD MEETING EXPENSE', 'BONUS', 'BOOKS & PERIODICALS', 'Buildings', 'CANCELLATION OF CHEQUE(JOT)', 'COMM OF BACKWARD CLASSES', 'COMPUTER TRAINING', 'COMPUTERS', 'CONTRIBUTION TO EPF & OTHER FUNDS', 'CONVEYANCE CHARGES', 'COST OF FUEL', 'DCCB INT', 'DCCB P.INT', 'DEPRECIATION', 'EDP INTEREST', 'EDP P INT.', 'ELECTRICITY CHARGES', 'EXHIBITION/ADVERTISEMENT EXEPNSES', 'FESTIVAL ADVANCE', 'FILING FEES', 'FIXED DEPOSIT', 'FURNITURE & FITTINGS', 'GRATUITY', 'Gain on sale of assets', 'GROUP INSURANCE SCHEME', 'GUARANTEE COMMISSIN PAYABLE TO TN GOVT', 'GUARANTEE COMMISSION TO T.N. GOVT.', 'Indian Bank T.Nagar Branch', 'INDUSIND BANK NUNGABAKKAM BR', 'INSURANCE', 'INTEREST ACCRUED ON FD', 'INTEREST ACCRUED ON ML LOAN', 'INTEREST ACCRUED ON SB A/C', 'INTEREST ACCURED BUT NOT DUE ON FD', 'INTEREST FROM TAMCO receivable', 'INTEREST ON FIXED DEPOSIT', 'INTEREST ON SAVING BANK A/C', 'INTEREST PAID TO NBCFDC', 'INTERIM ARREARS', 'INTERNAL AUDIT FEES PAYABLE', 'STATUTORY AUDIT FEES PAYABLE', 'INTEREST ON ML LOAN', 'INTERIM ARREARS', 'INTERNAL AUDIT FEES', 'IOB MOUNT ROAD', 'ISSUED SUBSCRIBED AND PAID-UP', 'Karur Vysya Bank Kodambakkam branch', 'LEAVE SALARY', 'LEGAL FEES', 'LOAN FOR SETTING UP OF MOBILE LAUNDRY', 'LOAN FROM NBCFDC (GTL)', 'LOAN FROM NBCFDC (MCS)', 'LOAN FROM NBCFDC (MSY)', 'LOAN HOSTEL -PRINCIPAL', 'LOAN TO AAVIN-PRINCIPAL', 'LOAN TO DCCB (GTL) - PRINCIPAL', 'LOAN TO EDP TRAINED WOMEN - PRINCIPAL', 'LOAN TO HDC-PRINCIPAL', 'LOAN TO ICS (AUTO)-PRINCIPAL (BC)', 'LOAN TO ICS (AUTO)-PRINCIPAL (G)', 'LOAN TO ICS (AUTO)-PRINCIPAL (M)', 'LOAN TO ICS (MML) PRINCIPAL', 'LOAN TO MICRO CREDIT SCHEME-PRINCIPAL', 'LOAN TO NSS -PRINCIPAL', 'LOAN TO PACB (GTL) - PRINCIPAL', 'LOAN TO SUGAR MILL-PRINCIPAL', 'LOAN TO TAICO-PRINCIPAL', 'LOAN TO UCB (GTL) -PRINCIPAL', 'MARGIN ON INTEREST PAYABLE TO SCAS (SC)', 'MAS INT.', 'MAS P.INT', 'MEDICAL EXPENSES', 'MEETING EXPENSE', 'MICRO CREDIT SCHEME INT', 'MICRO CREDIT SCHEME P.INT', 'MLL INT.', 'MLL P.INT', 'MOTOR CAR', 'NEW HEALTH INSURANCE SCHEME', 'NSS INTEREST', 'NSS P.INTEREST', 'OFFICE EQUIPMENT', 'OFFICE EXPENSE', 'OUTSTANDING EXPENSES', 'P.D. A/C - RBI', 'PACB INT', 'PACB P.INT', 'PENAL INTEREST ACCRUED', 'PENSION CONTRIBUTION', 'PETTY CASH', 'POSTAGE EXPENSES', 'PRINTING AND STATIONERY', 'PROFEESIONAL FEES', 'PROFIT AND LOSS ACCOUNT', 'PROVISION FOR BAD & DOUDTFUL DEBTIS', 'PROVISION FOR BONUS', 'PROVISION FOR GRATUITY', 'PROVISION FOR LEAVE SALARY', 'Purchase of Telephone', 'REFRESHMENT CHARGES', 'REMUNERATION TO CHARMAN', 'RENT', 'REPAIR & MAINTENANCE', 'SALARIES', 'Sale of Tender Form', 'SERVICE CHARGES', 'SOFTWARE DEVELOPMENT ', 'STAMPS ON HAND', 'STATUTORY AUDIT FEES', 'STIPEND', 'SUBSIDY CHARGES RECEIVABLE FROM GOVT.', 'SUBSIDY RECEIVED FROM GOVT FOR ML', 'SYNDICATE BANK', 'EGMORE BR', 'TAICO INT', 'TAMCO', 'TAMILNADU STATE APEX CO-OP BANK', 'TAX AUDIT FEES', 'TDS ON BANK DEPOSITS', 'TDS ON RENT', 'TELEPHONE DEPOSIT', 'TELEPHONE CHARGES', 'TRAINING GRANT IN AID FROM NBCFDC', 'TRAVELLING EXPENSE/TTA', 'UCB INT', 'UCB P.INT', 'VEHICLE HIRE CHARGES', 'VEHICLE MAINTANCE', 'WORK IN PROGRESS', 'WAGES']


        $.each(selectValues, function(key, value) {
             $('.select')
                 .append($("<option></option>")
                            .attr("value",value)
                            .text(value));
        });
    }

    function addAnotherField() {
    var shg_det = $("#shgDetails");
    var inputSNO = "sno"+i;
    var accHead = "acchead"+i;
    var debit_amount = "debit_amount"+i;
    var credit_amount = "credit_amount"+i;
    var debit_bal = "new_debit_bal"+i;
    var credit_bal = "new_credit_bal"+i;
    console.log("add"+i);
    var row = $('<div style="display: flex; flex-direction: row; justify-content: space-around; align-items: center;"></div>')
        .html(
            '<div style="display: flex; flex: 3;">' +
            '<input class="amount" type="number" id='+inputSNO+' name='+inputSNO+' value='+(i+1)+'>' +
            '</div>' +
            '<div style="display: flex; flex: 5;">' +
            '<select class="select" id='+accHead+' name='+accHead+'>' +
            '</div>' +
            '<div style="display: flex; flex: 3;">' +
            '<input type="text" id='+debit_amount+' name='+debit_amount+'>' +
            '</div>' +
            '<div style="display: flex; flex: 3;">' +
            '<input type="text" id='+credit_amount+' onchange="populateNewBalances('+credit_amount+','+debit_amount+','+accHead+')" name='+credit_amount+'>' +
            '</div>' +
            '<div style="display: None; flex: 3; flex-direction: column;">' +
            '<label for='+credit_bal+'>Cl. Credit</label>' +
            '<input type="text" id='+credit_bal+' name='+credit_bal+'>' +
            '</div>' +
            '<div style="display: None; flex: 3; flex-direction: column;">' +
            '<label for='+debit_bal+'>Cl. Credit</label>' +
            '<input type="text" id='+debit_bal+' name='+debit_bal+'>' +
            '</div>'
        );
        shg_det.append(row);
        i++;
        document.getElementById("invID").value = i;
        populateSelect();
    }

    function populateTotals() {
        document.getElementById("invID").value = i;
        console.log(i, document.getElementById("invID").value);
        var total_debit_amount = 0;
        var total_credit_amount = 0;
        for(var iter = 0; iter <i; iter ++) {
            total_debit_amount += parseInt(document.getElementById("debit_amount"+iter).value);
            total_credit_amount += parseInt(document.getElementById("credit_amount"+iter).value);
        }
        document.getElementById("totalDebit").value = total_debit_amount;
        document.getElementById("totalCredit").value = total_credit_amount;
    }

</script>

{% endblock %}